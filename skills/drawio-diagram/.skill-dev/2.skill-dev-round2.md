# Round 2: 工具链精简与文档完善

> 2025-12-14

## 用户需求

1. 完善 .skill-dev 目录内容
2. 说明 draw.io Desktop CLI 图片预览功能
3. 分析 CLI 能力，精简脚本依赖

## 完成的工作

### 1. draw.io Desktop CLI 分析

发现 draw.io 桌面版内置强大 CLI：

```bash
/Applications/draw.io.app/Contents/MacOS/draw.io --export \
  --format png --scale 2 --output preview.png diagram.drawio
```

**CLI 支持的功能：**
- 导出 PNG/PDF/SVG/JPG
- 多页导出 (`--all-pages`, `--page-index`)
- 缩放/边框 (`--scale`, `--border`)
- 透明背景 (`--transparent`)
- 嵌入源图表 (`--embed-diagram`)
- 批量转换 (`--recursive`)

**CLI 不支持（脚本必需）：**
- XML 结构验证
- 自动修复 XML
- mxCell 包装
- Search/replace 编辑
- 追加/合并片段
- 截断检测

### 2. 脚本精简

**保留（核心）：**
- `validate-xml.ts` - 验证 XML
- `fix-xml.ts` - 自动修复
- `wrap-xml.js` - 包装+验证一体化
- `edit-xml.ts` - 精细编辑
- `append-xml.ts` - 处理截断
- `check-complete.ts` - 检测截断
- `merge-pages.js` - 多页合并
- `export-png.js` - 跨平台封装（可选）
- `format-xml.ts` - 格式化（可选）

**删除：**
- `wrap-xml.ts` - 被 `wrap-xml.js` 取代

### 3. 文档新增

- `.skill-dev/README.md` - 维护指南入口
- `.skill-dev/DESKTOP_CLI.md` - CLI 完整参考（安装、选项、场景）

### 4. SKILL.md 更新

添加 "Export Preview (draw.io Desktop CLI)" 章节：
- 直接 CLI 命令示例
- 常用选项速查表
- 引用详细文档

## 推荐工作流

```
生成 mxCells → wrap-xml.js (验证+包装) → draw.io CLI (导出预览)
```

## Git 提交

待提交文件：
- `.skill-dev/README.md` (新增)
- `.skill-dev/DESKTOP_CLI.md` (新增)
- `SKILL.md` (更新)
- `scripts/wrap-xml.ts` (删除)
